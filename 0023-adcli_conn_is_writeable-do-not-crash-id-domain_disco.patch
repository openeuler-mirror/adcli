From 026cfacabfad58ae2cebcdf6cd82d905023ea289 Mon Sep 17 00:00:00 2001
From: Sumit Bose <sbose@redhat.com>
Date: Thu, 31 May 2018 17:01:36 +0200
Subject: [PATCH 23/23] adcli_conn_is_writeable: do not crash id domain_disco
 is missing

Resolves https://bugzilla.redhat.com/show_bug.cgi?id=1575554
---
 library/adconn.c | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/library/adconn.c b/library/adconn.c
index d2fb1d5..e2250e3 100644
--- a/library/adconn.c
+++ b/library/adconn.c
@@ -1567,6 +1567,11 @@ adcli_conn_server_has_capability (adcli_conn *conn,
 
 bool adcli_conn_is_writeable (adcli_conn *conn)
 {
-    disco_dance_if_necessary (conn);
-    return ( (conn->domain_disco->flags & ADCLI_DISCO_WRITABLE) != 0);
+	disco_dance_if_necessary (conn);
+
+	if (conn->domain_disco == NULL) {
+		return false;
+	}
+
+	return ( (conn->domain_disco->flags & ADCLI_DISCO_WRITABLE) != 0);
 }
-- 
2.14.4

